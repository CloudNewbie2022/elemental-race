<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="favicon.ico?=v2" type="image/x-icon">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Angry Dynomites Leaderboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background-color: #1a1a1a;
      color: #ffffff;
    }
    h1 {
      text-align: center;
      color: #f39c12;
      margin-bottom: 30px;
    }
    #leaderboard {
      list-style: none;
      padding: 0;
    }
    .player {
      display: flex;
      justify-content: space-between;
      background-color: #2c3e50;
      margin-bottom: 10px;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .player-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .rank {
      font-weight: bold;
      font-size: 1.4em;
      min-width: 40px;
      text-align: center;
      color: #f1c40f;
    }
    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #3498db;
    }
    .name {
      font-weight: bold;
      font-size: 1.1em;
    }
    .points {
      color: #ecf0f1;
      font-size: 1.1em;
      font-weight: bold;
    }
    .position-change {
      margin-left: 10px;
      font-weight: bold;
      font-size: 0.9em;
    }
    .up {
      color: #2ecc71;
    }
    .down {
      color: #e74c3c;
    }
    .same {
      color: #3498db;
    }
    .new {
      color: #f39c12;
    }
    .podium {
      display: flex;
      justify-content: center;
      margin-bottom: 40px;
      gap: 20px;
      height: 250px;
      align-items: flex-end;
    }
    .podium-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 120px;
    }
    .podium-rank {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 15px;
      color: #ecf0f1;
    }
    .podium-name {
      font-weight: bold;
      margin-bottom: 10px;
      color: #f1c40f;
      text-align: center;
    }
    .podium-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid;
      margin-bottom: 10px;
    }
    .podium-bar {
      width: 100%;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      transition: height 0.5s ease;
    }
    .first-place {
      z-index: 3;
    }
    .first-place .podium-bar {
      background: linear-gradient(to top, #f1c40f, #f39c12);
      height: 100%;
    }
    .first-place .podium-avatar {
      border-color: #f1c40f;
    }
    .second-place {
      z-index: 2;
    }
    .second-place .podium-bar {
      background: linear-gradient(to top, #95a5a6, #7f8c8d);
      height: 66%;
    }
    .second-place .podium-avatar {
      border-color: #95a5a6;
    }
    .third-place {
      z-index: 1;
    }
    .third-place .podium-bar {
      background: linear-gradient(to top, #cd7f32, #b87333);
      height: 33%;
    }
    .third-place .podium-avatar {
      border-color: #cd7f32;
    }
    .controls {
      display: flex;
      justify-content: center;
      margin: 30px 0;
      gap: 15px;
    }
    button {
      padding: 10px 20px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #2980b9;
    }
    button:disabled {
      background-color: #7f8c8d;
      cursor: not-allowed;
    }
    #status {
      text-align: center;
      margin: 20px 0;
      font-style: italic;
      color: #bdc3c7;
    }
    @keyframes highlight {
      0% { background-color: rgba(46, 204, 113, 0.5); }
      100% { background-color: #2c3e50; }
    }
    .highlight {
      animation: highlight 2s;
    }
    .loading {
      text-align: center;
      padding: 30px;
      font-style: italic;
      color: #7f8c8d;
      font-size: 1.2em;
    }
    .error {
      color: #e74c3c;
      text-align: center;
      padding: 20px;
      font-weight: bold;
    }
    #leaderboardCanvas {
      background-color: #2c2c2c; /* Dark mechanical backdrop */
      border: 4px solid purple;
      border-radius: 8px;
      display: block;
      margin: 0 auto;
    }

    body {
      background-color: #1e1e1e;
      font-family: 'Orbitron', sans-serif;
      color: #fff;
      margin: 0;
      padding: 2rem;
    }
    .leaderboard-container {
      max-width: 1000px;
      margin: 0 auto;
    }
    .player-bar {
      display: flex;
      align-items: center;
      margin-bottom: 1.5rem;
      background-color: #2c2c2c;
      border: 2px solid #8e44ad;
      border-radius: 10px;
      padding: 10px;
      position: relative;
      overflow: hidden;
    }
    .player-bar .avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      margin-right: 1rem;
      flex-shrink: 0;
    }
    .player-bar .bar {
      background-image: url('asset/generative-art=1.gif'); /* Replace with your looping AI art */
      background-size: cover;
      height: 40px;
      border-radius: 8px;
      transition: width 0.6s ease;
    }
    .bar-wrapper {
      flex-grow: 1;
      background-color: #3b3b3b;
      border-radius: 8px;
      overflow: hidden;
    }
    .player-bar .label {
      margin-left: 1rem;
      white-space: nowrap;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <h1>Angry Dynomites Leaderboard</h1>

  <section id="chart-tools" style="margin-bottom: 1rem;">
    <label for="chartWidth">Width:</label>
    <input type="number" id="chartWidth" value="800" min="300" max="1600">
    <label for="chartHeight">Height:</label>
    <input type="number" id="chartHeight" value="400" min="200" max="1000">
    <button id="updateChartSize">Update Chart Size</button>
  </section>
  
  <canvas id="leaderboardChart" width="800" height="400"></canvas>
  

  <div class="leaderboard-container" id="leaderboard"></div>

  <div class="podium">
    <div class="podium-step first-place">
      <div class="podium-rank">1st</div>
      <img class="podium-avatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=4" alt="Avatar">
      <div class="podium-name">Dynamite Dan</div>
      <div class="podium-bar"></div>
    </div>
    <div class="podium-step second-place">
      <div class="podium-rank">2nd</div>
      <img class="podium-avatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=5" alt="Avatar">
      <div class="podium-name">Blazing Betty</div>
      <div class="podium-bar"></div>
    </div>
    <div class="podium-step third-place">
      <div class="podium-rank">3rd</div>
      <img class="podium-avatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=6" alt="Avatar">
      <div class="podium-name">Pyro Pete</div>
      <div class="podium-bar"></div>
    </div>
  </div>
  <script>
      // Function to display the leaderboard
      function displayLeaderboard(leaderboardData) {
        if(leaderboardData.length == 0){
          console.error('No leaderboard data')
          return
        }


        const maxPoints = Math.max(...leaderboardData.map(p => p.masterpiecePoints));
        const leaderboardEl = document.getElementById('leaderboard');
        //Remove the previous leaderboard entries if they exist
        leaderboardEl.innerHTML = '';


        leaderboardData.forEach(player => {
          const wrapper = document.createElement('div');
          wrapper.className = 'player-bar';

          const avatar = document.createElement('img');
          avatar.className = 'avatar';
          avatar.src = player.profile.avatarUrl;
          avatar.src = player.profile.avatarUrl || 'asset/default-avatar.png';
          avatar.onerror = () => {
          avatar.src = 'asset/default-avatar.png';
      };

          const barWrapper = document.createElement('div');
          barWrapper.className = 'bar-wrapper';

          const bar = document.createElement('div');
          bar.className = 'bar';
          bar.style.width = `${(player.masterpiecePoints / maxPoints) * 100}%`;

          const label = document.createElement('div');
          label.className = 'label';
          label.textContent = `${player.profile.displayName} (${player.masterpiecePoints} pts)`;

          barWrapper.appendChild(bar);
          wrapper.appendChild(avatar);
          wrapper.appendChild(barWrapper);
          wrapper.appendChild(label);
          leaderboardEl.appendChild(wrapper);
        });
      }

      
   
  async function fetchData() {
    try {
      const response = await fetch('/graphql', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          query: `
            query {
              masterpiece(id: 110) {
                leaderboard {
                  profile {
                    displayName
                    avatarUrl
                  }
                  masterpiecePoints
                }
              }
            }
          `
        })
      });

      if (!response.ok) throw new Error('Network response was not ok.');

      const liveData = await response.json();
      const leaderboardData = liveData.data.masterpiece.leaderboard;

      displayLeaderboard(leaderboardData);
    } catch (error) {
      console.error('Fetch error:', error);
    }
  }

  function displayLeaderboard(leaderboardData) {
    if (!leaderboardData || leaderboardData.length === 0) {
      console.error('No leaderboard data');
      return;
    }

    const maxPoints = Math.max(...leaderboardData.map(p => p.masterpiecePoints));
    const leaderboardEl = document.getElementById('leaderboard');
    leaderboardEl.innerHTML = ''; // Clear any previous entries

    leaderboardData.slice(0,10).forEach(player => {
      const wrapper = document.createElement('div');
      wrapper.className = 'player-bar';

      
      const avatar = document.createElement('img');
      avatar.className = 'avatar';
      avatar.src = player.profile.avatarUrl;
      avatar.src = player.profile.avatarUrl || 'asset/default-avatar.png';
      avatar.onerror = () => {
      avatar.src = 'asset/default-avatar.png';
    };

      const barWrapper = document.createElement('div');
      barWrapper.className = 'bar-wrapper';

      const bar = document.createElement('div');
      bar.className = 'bar';
      bar.style.width = `${(player.masterpiecePoints / maxPoints) * 100}%`;

      const label = document.createElement('div');
      label.className = 'label';
      label.textContent = `${player.profile.displayName} (${player.masterpiecePoints} pts)`;

      barWrapper.appendChild(bar);
      wrapper.appendChild(avatar);
      wrapper.appendChild(barWrapper);
      wrapper.appendChild(label);
      leaderboardEl.appendChild(wrapper);
    });
  }

  // âœ… Call fetchData when page is ready
  document.addEventListener('DOMContentLoaded', fetchData);
</script>