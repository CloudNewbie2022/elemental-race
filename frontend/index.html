<style>
  body {
    background-color: #1e1e1e;
    font-family: 'Orbitron', sans-serif;
    color: #fff;
    margin: 0;
    padding: 2rem;
  }
  
  .leaderboard-container {
    max-width: 1000px;
    margin: 0 auto;
  }
  
  /* üß© Player Bar Styles */
  .player-bar {
    background: linear-gradient(135deg, #2c2c2c, #1a1a1a);
    border: 2px solid #8e44ad;
    border-radius: 10px;
    margin-bottom: 1.5rem;
    padding: 10px;
    display: flex;
    align-items: center;
    gap: 1rem;
    opacity: 0;
    transform: translateY(-50px);
    animation: dropIn 0.6s ease forwards;
  }
  
  /* Special Top 3 Styles */
  .player-bar.first {
    background: linear-gradient(135deg, #ffd700, #ff8c00);
    border: 3px solid gold;
    animation: pulseGold 2s infinite alternate, dropIn 0.6s ease forwards;
  }
  
  .player-bar.second {
    background: linear-gradient(135deg, #c0c0c0, #808080);
    border: 3px solid silver;
    animation: pulseSilver 2s infinite alternate, dropIn 0.6s ease forwards;
  }
  
  .player-bar.third {
    background: linear-gradient(135deg, #cd7f32, #8b4513);
    border: 3px solid #cd7f32;
    animation: pulseBronze 2s infinite alternate, dropIn 0.6s ease forwards;
  }
  
  /* Hover for Regular Players */
  .player-bar.hoverable:hover {
    background: linear-gradient(135deg, #8e44ad, #2c3e50);
    border: 2px solid rgba(255, 255, 255, 0.5);
    box-shadow: 0 0 12px rgba(255, 255, 255, 0.4);
    transform: scale(1.03);
    transition: all 0.2s ease-in-out;
  }
  
  /* Top 3 Avatar Hover */
  .player-bar.first .avatar:hover {
    border-color: gold;
    box-shadow: 0 0 15px gold;
  }
  
  .player-bar.second .avatar:hover {
    border-color: silver;
    box-shadow: 0 0 15px silver;
  }
  
  .player-bar.third .avatar:hover {
    border-color: #cd7f32;
    box-shadow: 0 0 15px #cd7f32;
  }
  
  /* üéØ Label */
  .label {
    max-width: 120px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    margin-right: 1rem;
    font-size: 1rem;
    font-weight: bold;
  }
  
  /* üìä Bar Wrapper */
  .bar-wrapper {
    flex-grow: 1;
    background-color: rgba(50, 56, 56, 0.25);
    border-radius: 8px;
    overflow: hidden;
    position: relative;
    height: 60px;
  }
  
  /* üìà Bar Fill */
  .bar {
    background-image: url('asset/generative-art=2.gif');
    background-size: cover;
    height: 100%;
    border-radius: 8px;
    opacity: 0;
    animation: fadeInBar 0.6s ease-out forwards;
  }
  
  /* üéûÔ∏è Avatars */
  .avatar-wrapper {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    overflow: hidden;
    perspective: 800px;
  }
  
  .avatar {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
    border: 2px solid transparent;
    transition: transform 0.2s ease, box-shadow 0.3s ease;
    transform-style: preserve-3d;
    box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
    position: relative;
    opacity: 1;
    animation: dropIn 0.5s ease-out forwards;
    z-index: 2;
  }
  
  /* Hover Animation for Avatar */
  .avatar-wrapper:hover .avatar {
    transform: scale(0.85) rotateX(5deg) rotateY(5deg);
  }
  
  /* --- Avatar Shine --- */
  .avatar-wrapper::before {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    width: 70px;
    height: 70px;
    background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0) 70%);
    border-radius: 50%;
    pointer-events: none;
    z-index: 1;
  }
  
  /* üèÜ Animations */
  @keyframes dropIn {
    0% {
      opacity: 0;
      transform: translateY(-50px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes fadeInBar {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes pulseGold {
    0% {
      box-shadow: 0 0 10px gold, 0 0 20px gold;
      transform: scale(1);
    }
    100% {
      box-shadow: 0 0 20px gold, 0 0 40px gold;
      transform: scale(1.02);
    }
  }
  
  @keyframes pulseSilver {
    0% {
      box-shadow: 0 0 10px silver, 0 0 20px silver;
      transform: scale(1);
    }
    100% {
      box-shadow: 0 0 20px silver, 0 0 40px silver;
      transform: scale(1.02);
    }
  }
  
  @keyframes pulseBronze {
    0% {
      box-shadow: 0 0 10px #cd7f32, 0 0 20px #cd7f32;
      transform: scale(1);
    }
    100% {
      box-shadow: 0 0 20px #cd7f32, 0 0 40px #cd7f32;
      transform: scale(1.02);
    }
  }
  </style>
  
  <select id="time-window-selector">
    <option value="3600000">Last Hour</option>        <!-- 1 hour -->
    <option value="14400000">Last 4 Hours</option>     <!-- 4 hours -->
    <option value="28800000">Last 8 Hours</option>     <!-- 8 hours -->
    <option value="86400000">Last 24 Hours</option>    <!-- 1 day -->
    <option value="604800000">Last 7 Days</option>     <!-- 1 week -->
  </select>
  

  </style>
</head>
<body>

  <h1 style="text-align:center; color:#f39c12; margin-bottom: 30px;">Angry Dynomites Leaderboard</h1>

  <div class="leaderboard-container" id="leaderboard">
    <!-- Example Entries -->
    <div class="player-bar first">
      <div class="label">Dynamite Dan</div>
      <img class="avatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=4" alt="Avatar">
      <div class="bar-wrapper"><div class="bar" style="width: 90%;"></div></div>
    </div>
    <div class="player-bar second">
      <div class="label">Blazing Betty</div>
      <img class="avatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=5" alt="Avatar">
      <div class="bar-wrapper"><div class="bar" style="width: 80%;"></div></div>
    </div>
    <div class="player-bar third">
      <div class="label">Pyro Pete</div>
      <img class="avatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=6" alt="Avatar">
      <div class="bar-wrapper"><div class="bar" style="width: 70%;"></div></div>
    </div>
  </div>
</body>
</html>








<button id="refresh-btn">üîÅ Refresh Leaderboard</button>
<p id="last-updated" style="margin-top: 0.5rem; color: #ccc; font-size: 0.9rem;">
  Last refreshed: never
</p>


<script>






  async function getLatestMasterpieceId() {
    try {
      const response = await fetch('https://elemental-race.onrender.com/graphql', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          query: `
            query {
              masterpiece {
                id
                name
              }
            }
          `
        })
      });
  
      const result = await response.json();
      const masterpiece = result?.data?.masterpiece;
      return masterpiece;
    } catch (err) {
      console.error('‚ùå Error fetching latest masterpiece:', err);
      return null;
    }
  }
  

  function filterByTimeWindow(players, timeWindowMs) {
  const now = Date.now();
  return players.filter(player => (now - player.timestamp) <= timeWindowMs);
}



  async function fetchDataAndUpdate() {
    const masterpiece = await getLatestMasterpieceId();
    if (!masterpiece?.id) return;
  
    // Update the title
    document.querySelector('h1').textContent = `${masterpiece.name} Leaderboard`;
  
    try {
      const response = await fetch('https://elemental-race.onrender.com/graphql', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          query: `
            query {
              masterpiece(id: ${masterpiece.id}) {
                leaderboard {
                  profile {
                    displayName
                    avatarUrl
                  }
                  masterpiecePoints
                }
              }
            }
          `
        })
      });
  
      const data = await response.json();
      const leaderboard = data?.data?.masterpiece?.leaderboard ?? [];
      const top10 = leaderboard
        .sort((a, b) => b.masterpiecePoints - a.masterpiecePoints)
        .slice(0, 10)
        .map(player => ({
          ...player,
          timestamp: Date.now() // Add timestamp for each player
        }));

      displayLeaderboard(top10);
      updateLastRefreshedTime(); // ‚úÖ NEW
    } catch (error) {
      console.error('‚ùå Fetch leaderboard error:', error);
    }
  }







  function displayLeaderboard(leaderboardData) {


  const maxPoints = Math.max(...leaderboardData.map(p => p.masterpiecePoints));
  const leaderboardEl = document.getElementById('leaderboard');
  leaderboardEl.innerHTML = '';

  leaderboardData.forEach((player, index) => {
    const rank = index + 1; // Define rank FIRST
    const wrapper = document.createElement('div');
    wrapper.className = 'player-bar';
    wrapper.setAttribute('data-rank', rank); // Optional: useful for CSS selectors
   
   // sequential animation delay
    wrapper.style.animationDelay = `${index * 0.5}s`;


    // Rank-specific classes
    if (rank === 1) {
      wrapper.classList.add('first');
      wrapper.classList.add('hoverable');
      wrapper.classList.add('highlight'); // Highlight the first player
    } else if (rank === 2) {
      wrapper.classList.add('second');
      wrapper.classList.add('hoverable');
      wrapper.classList.add('highlight');
    } else if (rank === 3) {
      wrapper.classList.add('third');
      wrapper.classList.add('hoverable');
      wrapper.classList.add('highlight');
    } else if (rank >= 4 && rank <= 10) {
      wrapper.classList.add('hoverable'); // For your new neutral glow
    }




// Avatar
const avatarWrapper = document.createElement('div');
avatarWrapper.className = 'avatar-wrapper';

const avatar = document.createElement('img');
avatar.className = 'avatar';
avatarWrapper.appendChild(avatar);

let avatarUrl = player.profile.avatarUrl ?? '';
let avatarSrc = 'asset/default-avatar.gif';

if (avatarUrl.startsWith('ipfs://')) {
  avatarSrc = avatarUrl.replace('ipfs://', 'https://ipfs.io/ipfs/');
} else if (avatarUrl.startsWith('http')) {
  avatarSrc = avatarUrl;
}

avatar.src = avatarSrc;

// Always fallback if loading fails
avatar.onerror = () => {
  avatar.src = 'asset/default-avatar.gif';
};

// üéØ Fix: Only wrapper controls movement!
avatarWrapper.addEventListener('mousemove', (e) => {
  const rect = avatarWrapper.getBoundingClientRect();
  const centerX = rect.width / 2;
  const centerY = rect.height / 2;
  const offsetX = e.clientX - rect.left - centerX;
  const offsetY = e.clientY - rect.top - centerY;

  // Rotate and shrink smoothly
  avatar.style.transform = `
    scale(0.85)
    rotateX(${offsetY * -0.2}deg)
    rotateY(${offsetX * 0.2}deg)
  `;
});

avatarWrapper.addEventListener('mouseleave', () => {
  avatar.style.transform = 'scale(1) rotateX(0deg) rotateY(0deg)';
});


    // Bar visualization
    const barWrapper = document.createElement('div');
    barWrapper.className = 'bar-wrapper';

    const bar = document.createElement('div');
    bar.style.width = `${(player.masterpiecePoints / maxPoints) * 100}%`;
    bar.style.backgroundImage = "url('asset/generative-art=2.gif')";
    bar.style.backgroundSize = "cover";

    const label = document.createElement('div');
    label.textContent = `${player.profile.displayName} (${player.masterpiecePoints} pts)`;

    // Append everything
   
    barWrapper.appendChild(avatarWrapper);     
    wrapper.appendChild(barWrapper);
    wrapper.appendChild(label);
    leaderboardEl.appendChild(wrapper);
  });
}

  
  // ‚úÖ Update and fade in refresh time
  function updateLastRefreshedTime() {
    const now = new Date();
    const timeStr = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    const dateStr = now.toLocaleDateString();
    const el = document.getElementById('last-updated');
    el.textContent = `Last refreshed: ${timeStr} on ${dateStr}`;
  
    // Fade in animation
    el.style.opacity = 0;
    el.style.transition = 'opacity 0.5s ease-in-out';
    requestAnimationFrame(() => {
      el.style.opacity = 1;
    });
  }
  
  // üéØ Button listener
  document.getElementById('refresh-btn').addEventListener('click', fetchDataAndUpdate);
  


  
  // üöÄ Initial load
  document.addEventListener('DOMContentLoaded', fetchDataAndUpdate);
  </script>
  