<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="favicon.ico?v2" type="image/x-icon">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Angry Dynomites Leaderboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #1e1e1e;
      font-family: 'Orbitron', sans-serif;
      color: #fff;
      margin: 0;
      padding: 2rem;
    }
    .leaderboard-container {
      max-width: 1000px;
      margin: 0 auto;
    }
    .player-bar { 
      display: flex;
      align-items: center;
      margin-bottom: 1.5rem;
      background-color: #2c2c2c;
      border: 2px solid #8e44ad;
      border-radius: 10px;
      padding: 10px;
      position: relative;
      overflow: hidden;
    }
    .player-bar .label {
      max-width: 120px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      margin-right: 1rem;
      font-size: 1rem;
      font-weight: bold;
    }
    .player-bar .avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      margin-right: 1rem;
      flex-shrink: 0;
      border: 2px solid transparent;
      transition: box-shadow 0.3s, border 0.3s;
    }
    .player-bar .bar-wrapper {
      flex-grow: 1;
      background-color: #3b3b3b;
      border-radius: 8px;
      overflow: hidden;
    }
    .player-bar .bar {
      background-image: url('asset/generative-art=2.gif');
      background-size: cover;
      height: 60px;
      border-radius: 8px;
      transition: width 0.6s ease;
    }

    /* Top 3 Styles */
    .player-bar.first .avatar:hover {
      border-color: #f1c40f;
      box-shadow: 0 0 15px #f1c40f;
    }
    .player-bar.second .avatar:hover {
      border-color: #bdc3c7;
      box-shadow: 0 0 15px #bdc3c7;
    }
    .player-bar.third .avatar:hover {
      border-color: #cd7f32;
      box-shadow: 0 0 15px #cd7f32;
    }
    .player-bar.first .bar {
      height: 80px;
    }

    .highlight {
      animation: highlight 2s;
    }

    @keyframes highlight {
      0% { background-color: rgba(46, 204, 113, 0.5); }
      100% { background-color: #2c2c2c; }
    }

    .error {
      color: #e74c3c;
      text-align: center;
      padding: 20px;
      font-weight: bold;
    }

    .player-bar[data-rank="4"]:hover,
  .player-bar[data-rank="5"]:hover {
  border: 2px solid rgba(105, 96, 96, 0.096);
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
  transition: all 0.2s ease-in-out;
  }


  .hoverable:hover {
  background-color: rgb(233, 2, 2);
  color: black;
  transform: scale(1.03);
  border-color: #999;
}

.hoverable:hover {
  background-color: rgba(87, 189, 138, 0.164);
  color: black;
  transform: scale(1.03);
  border-color: #999;
}

.player-bar.hoverable:hover {
  border: 2px solid rgba(255, 255, 255, 0.5);
  box-shadow: 0 0 12px rgba(255, 255, 255, 0.4);
  transition: all 0.2s ease-in-out;
}

.avatar {
  border: 2px solid red !important;
  background-color: white;
  opacity: 1 !important;
  transform: translateY(0) !important;
}



/* new avatar stuff */
.bar-wrapper {
  position: relative;
  height: 69px;
  overflow: visible;
}

.avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  position: absolute;
  bottom: 0;
  left: 0;
  transform: translateY(-100px);
  opacity: 0;
  animation: dropToBar 0.8s ease-out forwards;
  z-index: 3;
  pointer-events: auto;
  transition: transform 0.25s ease;
}

@keyframes dropToBar {
  from {
    transform: translateY(-100px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.avatar:hover {
  transform: translateY(0) rotate(10deg) translateX(15px);
}


.avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  position: relative;
  animation: dropIn 0.5s ease-out forwards;
  transition: transform 0.2s ease;
  z-index: 2;
}


/* --- New Neutral Highlight Behind Avatar --- */
.avatar-wrapper {
  position: relative;
  display: inline-block;
}

.avatar-wrapper::before {
  content: '';
  position: absolute;
  top: -5px;
  left: -5px;
  width: 50px;
  height: 50px;
  background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%);
  border-radius: 50%;
  z-index: 1;
  pointer-events: none;
}

/* --- Avatar Rolling and Shrinking Effect --- */
.avatar {
  position: relative;
  z-index: 2;
  width: 40px;
  height: 40px;
  transition: transform 0.2s ease, width 0.2s ease, height 0.2s ease;
}



@keyframes dropIn {
  from {
    top: -80px;
    opacity: 0;
  }
  to {
    top: 0;
    opacity: 1;
  }
}

  /* ... existing styles ... */

  .bar {
    opacity: 0;
    animation: fadeInBar 0.6s ease-out forwards;
  }

  @keyframes fadeInBar {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }


  



  </style>
</head>
<body>
  <h1 style="text-align:center; color:#f39c12; margin-bottom: 30px;">Angry Dynomites Leaderboard</h1>

  <div class="leaderboard-container" id="leaderboard">
    <!-- Example Entries -->
    <div class="player-bar first">
      <div class="label">Dynamite Dan</div>
      <img class="avatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=4" alt="Avatar">
      <div class="bar-wrapper"><div class="bar" style="width: 90%;"></div></div>
    </div>
    <div class="player-bar second">
      <div class="label">Blazing Betty</div>
      <img class="avatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=5" alt="Avatar">
      <div class="bar-wrapper"><div class="bar" style="width: 80%;"></div></div>
    </div>
    <div class="player-bar third">
      <div class="label">Pyro Pete</div>
      <img class="avatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=6" alt="Avatar">
      <div class="bar-wrapper"><div class="bar" style="width: 70%;"></div></div>
    </div>
  </div>
</body>
</html>








<button id="refresh-btn">üîÅ Refresh Leaderboard</button>
<p id="last-updated" style="margin-top: 0.5rem; color: #ccc; font-size: 0.9rem;">
  Last refreshed: never
</p>


<script>






  async function getLatestMasterpieceId() {
    try {
      const response = await fetch('https://elemental-race.onrender.com/graphql', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          query: `
            query {
              masterpiece {
                id
                name
              }
            }
          `
        })
      });
  
      const result = await response.json();
      const masterpiece = result?.data?.masterpiece;
      return masterpiece;
    } catch (err) {
      console.error('‚ùå Error fetching latest masterpiece:', err);
      return null;
    }
  }
  
  async function fetchDataAndUpdate() {
    const masterpiece = await getLatestMasterpieceId();
    if (!masterpiece?.id) return;
  
    // Update the title
    document.querySelector('h1').textContent = `${masterpiece.name} Leaderboard`;
  
    try {
      const response = await fetch('https://elemental-race.onrender.com/graphql', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          query: `
            query {
              masterpiece(id: ${masterpiece.id}) {
                leaderboard {
                  profile {
                    displayName
                    avatarUrl
                  }
                  masterpiecePoints
                }
              }
            }
          `
        })
      });
  
      const data = await response.json();
      const leaderboard = data?.data?.masterpiece?.leaderboard ?? [];
      const top10 = leaderboard
        .sort((a, b) => b.masterpiecePoints - a.masterpiecePoints)
        .slice(0, 10);
  
      displayLeaderboard(top10);
      updateLastRefreshedTime(); // ‚úÖ NEW
    } catch (error) {
      console.error('‚ùå Fetch leaderboard error:', error);
    }
  }
  
  function displayLeaderboard(leaderboardData) {
  const maxPoints = Math.max(...leaderboardData.map(p => p.masterpiecePoints));
  const leaderboardEl = document.getElementById('leaderboard');
  leaderboardEl.innerHTML = '';

  leaderboardData.forEach((player, index) => {
    const rank = index + 1; // Define rank FIRST
    const wrapper = document.createElement('div');
    wrapper.className = 'player-bar';
    wrapper.setAttribute('data-rank', rank); // Optional: useful for CSS selectors

    // Rank-specific classes
    if (rank === 1) {
      wrapper.classList.add('first');
      wrapper.classList.add('hoverable');
      wrapper.classList.add('highlight'); // Highlight the first player
    } else if (rank === 2) {
      wrapper.classList.add('second');
      wrapper.classList.add('hoverable');
      wrapper.classList.add('highlight');
    } else if (rank === 3) {
      wrapper.classList.add('third');
      wrapper.classList.add('hoverable');
      wrapper.classList.add('highlight');
    } else if (rank >= 4 && rank <= 10) {
      wrapper.classList.add('hoverable'); // For your new neutral glow
    }

    // Avatar
    const avatarWrapper = document.createElement('div');
avatarWrapper.className = 'avatar-wrapper';

const avatar = document.createElement('img');
avatar.className = 'avatar';

avatarWrapper.appendChild(avatar);


let avatarUrl = player.profile.avatarUrl ?? ''; // safe fallback if null
let avatarSrc = 'asset/default-avatar.gif';   // default image

if (avatarUrl.startsWith('ipfs://')) {
  avatarSrc = avatarUrl.replace('ipfs://', 'https://ipfs.io/ipfs/');
} else if (avatarUrl.startsWith('http')) {
  avatarSrc = avatarUrl;
}

console.log('üéØ Avatar URL:', player.profile.displayName, avatarUrl);

avatar.src = avatarSrc;

// Always fallback if loading fails
avatar.onerror = () => {
  avatar.src = 'asset/default-avatar.gif';
};



avatarWrapper.addEventListener('mousemove', (e) => {
  const rect = avatarWrapper.getBoundingClientRect();
  const centerX = rect.width / 2;
  const centerY = rect.height / 2;
  const offsetX = e.offsetX - centerX;
  const offsetY = e.offsetY - centerY;

  // Rotate and shrink
  avatar.style.transform = `
    scale(0.85)
    rotateX(${offsetY * 0.2}deg)
    rotateY(${offsetX * 0.2}deg)
  `;
});

avatarWrapper.addEventListener('mouseleave', () => {
  avatar.style.transform = 'scale(1) rotateX(0) rotateY(0)';
});


    avatar.addEventListener('mousemove', (e) => {
  const offsetX = e.offsetX - avatar.offsetWidth / 2;
  const offsetY = e.offsetY - avatar.offsetHeight / 2;
  avatar.style.transform = `translate(${offsetX * 0.3}px, ${offsetY * 0.3}px) rotate(${offsetX * 0.1}deg)`;
});

avatar.addEventListener('mouseleave', () => {
  avatar.style.transform = 'translate(0, 0)';
});


    // Bar visualization
    const barWrapper = document.createElement('div');
    barWrapper.className = 'bar-wrapper';

    const bar = document.createElement('div');
    bar.style.width = `${(player.masterpiecePoints / maxPoints) * 100}%`;
    bar.style.backgroundImage = "url('asset/generative-art=2.gif')";
    bar.style.backgroundSize = "cover";

    const label = document.createElement('div');
    label.textContent = `${player.profile.displayName} (${player.masterpiecePoints} pts)`;

    // Append everything
    barWrapper.appendChild(bar);
    barWrapper.appendChild(avatarWrapper);     
    wrapper.appendChild(barWrapper);
    wrapper.appendChild(label);
    leaderboardEl.appendChild(wrapper);
  });
}

  
  // ‚úÖ Update and fade in refresh time
  function updateLastRefreshedTime() {
    const now = new Date();
    const timeStr = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    const dateStr = now.toLocaleDateString();
    const el = document.getElementById('last-updated');
    el.textContent = `Last refreshed: ${timeStr} on ${dateStr}`;
  
    // Fade in animation
    el.style.opacity = 0;
    el.style.transition = 'opacity 0.5s ease-in-out';
    requestAnimationFrame(() => {
      el.style.opacity = 1;
    });
  }
  
  // üéØ Button listener
  document.getElementById('refresh-btn').addEventListener('click', fetchDataAndUpdate);
  
  // üöÄ Initial load
  document.addEventListener('DOMContentLoaded', fetchDataAndUpdate);
  </script>
  