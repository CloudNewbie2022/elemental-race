<style>
  body {
    background-color: #1e1e1e;
    font-family: 'Orbitron', sans-serif;
    color: #fff;
    margin: 0;
    padding: 2rem;
  }
  
  .leaderboard-container {
    max-width: 1000px;
    margin: 0 auto;
  }
  
  

  /* üß© Player Bar Styles */
  .player-bar {
    background: linear-gradient(135deg, #2c2c2c, #1a1a1a);
    border: 2px solid #8e44ad;
    border-radius: 10px;
    margin-bottom: 1.5rem;
    padding: 10px;
    display: flex;
    align-items: center;
    gap: 1rem;
    opacity: 0;
    transform: translateY(-50px);
    animation: dropIn 0.6s ease forwards;
  }

  /* Special Top 3 Styles */
  .player-bar.first {
    background: linear-gradient(135deg, #ffd700, #ff8c00);
    border: 3px solid gold;
    animation: pulseGold 2s infinite alternate, dropIn 0.6s ease forwards;
  }
  
  .player-bar.second {
    background: linear-gradient(135deg, #c0c0c0, #808080);
    border: 3px solid silver;
    animation: pulseSilver 2s infinite alternate, dropIn 0.6s ease forwards;
  }
  
  .player-bar.third {
    background: linear-gradient(135deg, #cd7f32, #8b4513);
    border: 3px solid #cd7f32;
    animation: pulseBronze 2s infinite alternate, dropIn 0.6s ease forwards;
  }
  
  /* Hover for Regular Players */
  .player-bar.hoverable:hover {
    background: linear-gradient(135deg, #8e44ad, #2c3e50);
    border: 2px solid rgba(255, 255, 255, 0.5);
    box-shadow: 0 0 12px rgba(255, 255, 255, 0.4);
    transform: scale(1.03);
    transition: all 0.2s ease-in-out;
  }
  
  /* Top 3 Avatar Hover */
  .player-bar.first .avatar:hover {
    border-color: gold;
    box-shadow: 0 0 15px gold;
  }
  
  .player-bar.second .avatar:hover {
    border-color: silver;
    box-shadow: 0 0 15px silver;
  }
  
  .player-bar.third .avatar:hover {
    border-color: #cd7f32;
    box-shadow: 0 0 15px #cd7f32;
  }
  
  /* üéØ Label */
  .label {
    max-width: 120px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    margin-right: 1rem;
    font-size: 1rem;
    font-weight: bold;
  }
  
  /* üìä Bar Wrapper */
  .bar-wrapper {
    flex-grow: 1;
    background-color: rgba(50, 56, 56, 0.25);
    border-radius: 8px;
    overflow: hidden;
    position: relative;
    height: 60px;
  }
  
  /* üìà Bar Fill */
  .bar {
    background-image: url('asset/generative-art=2.gif');
    background-size: cover;
    height: 100%;
    border-radius: 8px;
    opacity: 0;
    animation: fadeInBar 0.6s ease-out forwards;
  }
  

/* üìà Bar Fill */
.bar {
  background-image: url('asset/generative-art=2.gif');
  background-size: cover;
  background-repeat: repeat-x; /* ADD THIS */
  height: 100%;
  border-radius: 8px;
  opacity: 0;
  animation: fadeInBar 0.01s ease-out forwards, scrollBackground 126s linear infinite; /* ADD scrollBackground animation */
}

/* üèÉ Bar Scroll Animation */
@keyframes scrollBackground {
  0% { background-position: 0 0; }
  100% { background-position: 1000px 0; }
}


  /* ü™µ Drawer (Wood Textured Card) */
  .drawer {
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 0;
    background: url('asset/wood-texture.jpg') center/cover no-repeat;
    overflow: hidden;
    border-radius: 10px;
    box-shadow: 2px 2px 12px rgba(0,0,0,0.6);
    transition: width 0.7s cubic-bezier(0.22, 1, 0.36, 1); /* springy easing */
    z-index: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 10px;
    color: #fff;
  }

  .drawer a {
    color: #ffd700;
    text-decoration: none;
    font-weight: bold;
    margin-bottom: 8px;
  }

  /* When Drawer is open */
  .drawer.open {
    width: 220px; /* Drawer size */
  }

  /* üéØ Make sure the bar-wrapper is relative */
  .bar-wrapper {
    position: relative;
    overflow: visible;
  }




#spinner {
  font-size: 2rem;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg);}
  100% { transform: rotate(360deg);}
}


  
  /* üéûÔ∏è Avatars */
  .avatar-wrapper {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    overflow: hidden;
    perspective: 800px;
  }
  
  .avatar {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
    border: 2px solid transparent;
    transition: transform 0.2s ease, box-shadow 0.3s ease;
    transform-style: preserve-3d;
    box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
    position: relative;
    opacity: 1;
    animation: dropIn 0.5s ease-out forwards;
    z-index: 2;
  }
  
  /* Hover Animation for Avatar */
  .avatar-wrapper:hover .avatar {
    transform: scale(0.85) rotateX(5deg) rotateY(5deg);
  }
  
  /* --- Avatar Shine --- */
  .avatar-wrapper::before {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    width: 70px;
    height: 70px;
    background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0) 70%);
    border-radius: 50%;
    pointer-events: none;
    z-index: 1;
  }
  
  /* üèÜ Animations */
  @keyframes dropIn {
    0% {
      opacity: 0;
      transform: translateY(-50px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes fadeInBar {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes pulseGold {
    0% {
      box-shadow: 0 0 10px gold, 0 0 20px gold;
      transform: scale(1);
    }
    100% {
      box-shadow: 0 0 20px gold, 0 0 40px gold;
      transform: scale(1.02);
    }
  }
  
  @keyframes pulseSilver {
    0% {
      box-shadow: 0 0 10px silver, 0 0 20px silver;
      transform: scale(1);
    }
    100% {
      box-shadow: 0 0 20px silver, 0 0 40px silver;
      transform: scale(1.02);
    }
  }
  
  @keyframes pulseBronze {
    0% {
      box-shadow: 0 0 10px #cd7f32, 0 0 20px #cd7f32;
      transform: scale(1);
    }
    100% {
      box-shadow: 0 0 20px #cd7f32, 0 0 40px #cd7f32;
      transform: scale(1.02);
    }
  }
  </style>
  
  <style>
    .fade-in {
      animation: fadeIn 0.5s ease-in forwards;
    }
    
    .fade-out {
      animation: fadeOut 0.5s ease-out forwards;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    @keyframes fadeOut {
      from {
        opacity: 1;
        transform: translateX(0);
      }
      to {
        opacity: 0;
        transform: translateX(20px);
      }
    }


    
    </style>
    


  <select id="time-window-selector">
    <option value="3600000">Last Hour</option>        <!-- 1 hour -->
    <option value="14400000">Last 4 Hours</option>     <!-- 4 hours -->
    <option value="28800000">Last 8 Hours</option>     <!-- 8 hours -->
    <option value="86400000">Last 24 Hours</option>    <!-- 1 day -->
    <option value="604800000">Last 7 Days</option>     <!-- 1 week -->
  </select>
  

  </style>
</head>
<body>


  <!-- üåü Loading Screen -->
<div id="loading-screen" style="display: none; text-align: center; padding: 2rem;">
  <h2 style="color: #f39c12;">Connecting to Live Leaderboard...</h2>
  <p style="color: #ccc;">Please wait, establishing a secure connection.</p>
  <div id="spinner" style="margin-top: 1rem;">
    üîÑ
  </div>
</div>




  <h1 style="text-align:center; color:#f39c12; margin-bottom: 30px;">Angry Dynomites Leaderboard</h1>

  <div class="leaderboard-container" id="leaderboard">
    <!-- Example Entries -->
    <div class="player-bar first">
      <div class="label">Dynamite Dan</div>
      <img class="avatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=4" alt="Avatar">
      <div class="bar-wrapper"><div class="bar" style="width: 90%;"></div></div>
    </div>
    <div class="player-bar second">
      <div class="label">Blazing Betty</div>
      <img class="avatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=5" alt="Avatar">
      <div class="bar-wrapper"><div class="bar" style="width: 80%;"></div></div>
    </div>
    <div class="player-bar third">
      <div class="label">Pyro Pete</div>
      <img class="avatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=6" alt="Avatar">
      <div class="bar-wrapper"><div class="bar" style="width: 70%;"></div></div>
    </div>
  </div>
</body>
</html>








<button id="refresh-btn">üîÅ Refresh Leaderboard</button>
<p id="last-updated" style="margin-top: 0.5rem; color: #ccc; font-size: 0.9rem;">
  Last refreshed: never
</p>




<script>
// üåü Show / Hide Loading Screen
function showLoadingScreen() {
  document.getElementById('loading-screen').style.display = 'block';
  document.getElementById('leaderboard').style.opacity = '0'; // hide leaderboard
}

function hideLoadingScreen() {
  document.getElementById('loading-screen').style.display = 'none';
  document.getElementById('leaderboard').style.opacity = '1'; // fade in leaderboard
}

// üöÄ Fetch Leaderboard Data
async function fetchDataAndUpdate() {
  showLoadingScreen();
  try {
    const response = await fetch('https://elemental-race.onrender.com/graphql', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        query: `
          query {
            masterpiece {
              id
              name
              leaderboard {
                profile {
                  displayName
                  avatarUrl
                }
                masterpiecePoints
              }
            }
          }
        `
      })
    });

    const data = await response.json();
    const masterpiece = data?.data?.masterpiece;

    if (!masterpiece?.leaderboard?.length) {
      console.warn('‚ö†Ô∏è No leaderboard data received ‚Äî keeping fallback mock data.');
      hideLoadingScreen();
      return;
    }

    document.querySelector('h1').textContent = `${masterpiece.name} Leaderboard`;

    displayLeaderboard(
      masterpiece.leaderboard
        .sort((a, b) => b.masterpiecePoints - a.masterpiecePoints)
        .slice(0, 10)
        .map(player => ({
          ...player,
          timestamp: Date.now()
        }))
    );

    updateLastRefreshedTime();
    hideLoadingScreen();

  } catch (error) {
    console.error('‚ùå Fetch leaderboard error:', error);
    console.warn('‚ö†Ô∏è Keeping fallback mock data.');
    hideLoadingScreen();
  }
}

// üïí Auto-Refresh with Smart Pause
let refreshInterval = null;

function startAutoRefresh() {
  console.log('üîÑ Auto-refresh started (every 60 seconds)');
  fetchDataAndUpdate();
  refreshInterval = setInterval(fetchDataAndUpdate, 60000);
}

function stopAutoRefresh() {
  if (refreshInterval) {
    console.log('üõë Auto-refresh stopped (tab hidden)');
    clearInterval(refreshInterval);
    refreshInterval = null;
  }
}

document.addEventListener('visibilitychange', () => {
  if (document.hidden) {
    stopAutoRefresh();
  } else {
    startAutoRefresh();
  }
});

// üöÄ Initial Load
document.addEventListener('DOMContentLoaded', startAutoRefresh);

// üé® Build Leaderboard
function displayLeaderboard(leaderboardData) {
  const maxPoints = Math.max(...leaderboardData.map(p => p.masterpiecePoints));
  const leaderboardEl = document.getElementById('leaderboard');

  // Fade out leaderboard before updating
  leaderboardEl.style.opacity = '0';
  
  setTimeout(() => {
    leaderboardEl.innerHTML = '';

    leaderboardData.forEach((player, index) => {
      const rank = index + 1;
      const wrapper = document.createElement('div');
      wrapper.className = 'player-bar fade-in';
      wrapper.style.animationDelay = `${index * 0.2}s`;

      if (rank === 1) wrapper.classList.add('first', 'hoverable');
      else if (rank === 2) wrapper.classList.add('second', 'hoverable');
      else if (rank === 3) wrapper.classList.add('third', 'hoverable');
      else wrapper.classList.add('hoverable');

      // üñºÔ∏è Avatar
      const avatarWrapper = document.createElement('div');
      avatarWrapper.className = 'avatar-wrapper';
      const avatar = document.createElement('img');
      avatar.className = 'avatar';
      let avatarUrl = player.profile.avatarUrl ?? '';
      let avatarSrc = 'asset/default-avatar.gif';

      if (avatarUrl.startsWith('ipfs://')) {
        avatarSrc = avatarUrl.replace('ipfs://', 'https://ipfs.io/ipfs/');
      } else if (avatarUrl.startsWith('http')) {
        avatarSrc = avatarUrl;
      }
      avatar.src = avatarSrc;
      avatar.onerror = () => {
        avatar.src = 'asset/default-avatar.gif';
      };
      avatarWrapper.appendChild(avatar);

      // ü™µ Drawer under avatar
      const drawer = document.createElement('div');
      drawer.className = 'drawer';
      drawer.innerHTML = `
        <a href="https://example.com/player/${player.profile.displayName}" target="_blank">View Profile</a>
        <a href="https://example.com/stats/${player.profile.displayName}" target="_blank">View Stats</a>
      `;
      avatarWrapper.appendChild(drawer);

      avatarWrapper.addEventListener('mouseenter', () => drawer.classList.add('open'));
      avatarWrapper.addEventListener('mouseleave', () => drawer.classList.remove('open'));

      // Hover physics
      avatarWrapper.addEventListener('mousemove', (e) => {
        const rect = avatarWrapper.getBoundingClientRect();
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        const offsetX = e.clientX - rect.left - centerX;
        const offsetY = e.clientY - rect.top - centerY;
        avatar.style.transform = `scale(0.85) rotateX(${offsetY * -0.2}deg) rotateY(${offsetX * 0.2}deg)`;
      });

      avatarWrapper.addEventListener('mouseleave', () => {
        avatar.style.transform = 'scale(1) rotateX(0deg) rotateY(0deg)';
      });

      // üè∑Ô∏è Label
      const label = document.createElement('div');
      label.className = 'label';
      label.textContent = `${player.profile.displayName} (${player.masterpiecePoints} pts)`;

      // üìä Bar
      const barWrapper = document.createElement('div');
      barWrapper.className = 'bar-wrapper';
      const bar = document.createElement('div');
      bar.className = 'bar';
      bar.style.width = `${(player.masterpiecePoints / maxPoints) * 100}%`;
      barWrapper.appendChild(bar);

      wrapper.appendChild(avatarWrapper);
      wrapper.appendChild(label);
      wrapper.appendChild(barWrapper);

      leaderboardEl.appendChild(wrapper);
    });

    // Fade back in
    requestAnimationFrame(() => {
      leaderboardEl.style.opacity = '1';
    });
  }, 300); // fade timing
}

// üîÑ Update Last Refreshed Time
function updateLastRefreshedTime() {
  const now = new Date();
  const timeStr = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  const dateStr = now.toLocaleDateString();
  const el = document.getElementById('last-updated');
  el.textContent = `Last refreshed: ${timeStr} on ${dateStr}`;
  el.style.opacity = 0;
  el.style.transition = 'opacity 0.5s ease-in-out';
  requestAnimationFrame(() => {
    el.style.opacity = 1;
  });
}
</script>
